using DoubleDouble;
using DoubleDoubleComplex;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using System;

namespace DoubleDoubleComplexTests {
    using NComplex = System.Numerics.Complex;

    [TestClass()]
    public class ComplexAsinAcosTests {

        [TestMethod()]
        public void AsinTest() {
            foreach (Complex z in new[] { (1, 2), (2, 5), (6, -3), (7, -4), (3, -9), (7, 1), (-3, -4), (-1, -9), (-2, 1) }) {
                Complex c = Complex.Asin(z);
                NComplex nc = NComplex.Asin((NComplex)z);

                ComplexAssert.AreEqual(nc, c, 1e-7);
            }
        }

        [TestMethod()]
        public void AcosTest() {
            foreach (Complex z in new[] { (1, 2), (2, 5), (6, -3), (7, -4), (3, -9), (7, 1), (-3, -4), (-1, -9), (-2, 1) }) {
                Complex c = Complex.Acos(z);
                NComplex nc = NComplex.Acos((NComplex)z);

                ComplexAssert.AreEqual(nc, c, 1e-7);
            }
        }

        [TestMethod()]
        public void AtanTest() {
            foreach (Complex z in new[] { (1, 2), (2, 5), (6, -3), (7, -4), (3, -9), (7, 1), (-3, -4), (-1, -9), (-2, 1) }) {
                Complex c = Complex.Atan(z);
                NComplex nc = NComplex.Atan((NComplex)z);

                ComplexAssert.AreEqual(nc, c, 1e-7);
            }
        }

        [TestMethod()]
        public void AsinNearZeroTest() {
            Complex[] expecteds_r0p125 = [
                "1.2532783116806539687456698635708471804815e-1",
                "1.2532685470900169421510516229613049809151e-1+3.9371192713314380371569894621213091057264e-3i",
                "1.2532392547163138319836991312652671411802e-1+7.8741746095528222103151141906480165415236e-3i",
                "1.2531904387536010879657765274744361968986e-1+1.1811102091443242843240650791736267521250e-2i",
                "1.2531221061900817226098649501384367941790e-1+1.5747837813555628088896830387972969464166e-2i",
                "1.2530342668052703152886222673950299339242e-1+1.9684317902092540541693329355619854080241e-2i",
                "1.2529269331660272348868542633054673175230e-1+2.3620478522768638458391852540279627072627e-2i",
                "1.2528001206214652927269903184465933773190e-1+2.7556255890655375390848925024927177063233e-2i",
                "1.2526538472967329475778174378290252931438e-1+3.1491586280003528224990112402836052876651e-2i",
                "1.2524881340856790890661917900519898010362e-1+3.5426406034039163812515407619503091170545e-2i",
                "1.2523030046424053234895262200427067099071e-1+3.9360651574728678543720816071959135683505e-2i",
                "1.2520984853717125756644385968029075924405e-1+4.3294259412508573304311649377812131593862e-2i",
                "1.2518746054184497008518790222050998342502e-1+4.7227166155975658243028868533203735834528e-2i",
                "1.2516313966557726707981348164664095896067e-1+5.1159308521533417601286356066076513447142e-2i",
                "1.2513688936723237563724627201200913665496e-1+5.5090623342990304466038621095073795238653e-2i",
                "1.2510871337583409750374586562961146840666e-1+5.9021047581105778642345400452503090049211e-2i",
                "1.2507861568907089033552359339477802552693e-1+6.2950518333079947836657498413251922948958e-2i",
                "1.2504660057169627718366359847360427140482e-1+6.6878972841982722924459548202085629173787e-2i",
                "1.2501267255382585606377134462014224442513e-1+7.0806348506118452170132964602681457079595e-2i",
                "1.2497683642913225988853593935764070340247e-1+7.4732582888322056791303644674920208999258e-2i",
                "1.2493909725293949367938584990819328897584e-1+7.8657613725182751128251101726789623423729e-2i",
                "1.2489946034021815072738915400457346665755e-1+8.2581378936191494800290512447307865900713e-2i",
                "1.2485793126348308215299370749074652494028e-1+8.6503816632808391510087511719514653911556e-2i",
                "1.2481451585059516503252044836767401134267e-1+9.0424865127446319494110556479467728748527e-2i",
                "1.2476922018246888283397085178195690489813e-1+9.4344462942367151909363728765142651896575e-2i",
                "1.2472205059068749825733673494175595494976e-1+9.8262548818487001585912303755616466763529e-2i",
                "1.2467301365502766263117584569926586911316e-1+1.0217906172408700345072976539458884080353e-1i",
                "1.2462211620089536770814226075089700367114e-1+1.0609394086342622942699204577067558079722e-1i",
                "1.2456936529667520496237499360324730846337e-1+1.1000712568525341461702119224371694933317e-1i",
                "1.2451476825099495426071626462909590380049e-1+1.1391855589121425996675069804036706755698e-1i",
                "1.2445833260990757800192209453697139625162e-1+1.1782817144415116526243296592659074215804e-1i",
                "1.2440006615399274844238209538945760862418e-1+1.2173591257629233710164839267539748357833e-1i",
                "1.2433997689538008490724618342855496186087e-1+1.2564171979732730928380583760481077072197e-1i",
                "1.2427807307469632388099189806870384737369e-1+1.2954553390236600775179555101774480787664e-1i",
                "1.2421436315793868854497912295953906681409e-1+1.3344729597977858865632925836941404602356e-1i",
                "1.2414885583327676514996136817522624657045e-1+1.3734694741891337617661300840055499045539e-1i",
                "1.2408156000778523165230091949608664071912e-1+1.4124442991769032628321684126016019946101e-1i",
                "1.2401248480410981928212247372090656693219e-1+1.4513968549006754353849697400205025204017e-1i",
                "1.2394163955706892013307725255404499919923e-1+1.4903265647337848016341019027282280178668e-1i",
                "1.2386903381019328345487456950666385730150e-1+1.5292328553553754982356444219853045802915e-1i",
                "1.2379467731220627008418250396634907646692e-1+1.5681151568211199276846307144095280120499e-1i",
                "1.2371858001344715836457728420577955739131e-1+1.6069729026325793396301994568240580577173e-1i",
                "1.2364075206224001598430356869390906681465e-1+1.6458055298051868154699853585624906501845e-1i",
                "1.2356120380121067040869028285947686749289e-1+1.6846124789348341921429887231570318003018e-1i",
                "1.2347994576355432601368432470698866451522e-1+1.7233931942630455278924404741616980719547e-1i",
                "1.2339698866925638865409942152998561441163e-1+1.7621471237407207826171240704566481884773e-1i",
                "1.2331234342126906824515637421071930067680e-1+1.8008737190904344569910025170271759483918e-1i",
                "1.2322602110164633702327426248437691952907e-1+1.8395724358672750065433972798274800875510e-1i",
                "1.2313803296763982551053512105866104522808e-1+1.8782427335182119181107846488826190076653e-1i",
                "1.2304839044775823986945067714787803179383e-1+1.9168840754399784052727235127064845182177e-1i",
                "1.2295710513779288333712726441087608768760e-1+1.9554959290354587453673959447749607316108e-1i",
                "1.2286418879681186081088691749004250679819e-1+1.9940777657685703422700886999877766693776e-1i",
                "1.2276965334312553946466028172206968792603e-1+2.0326290612176316551602016176187626663724e-1i",
                "1.2267351085022582955423851376920855592327e-1+2.0711492951272081828763495923117106294068e-1i",
                "1.2257577354270183837023514715920624118249e-1+2.1096379514584297350714322470873848108373e-1i",
                "1.2247645379213443667394244844909640632202e-1+2.1480945184377732541674921758531082612968e-1i",
                "1.2237556411297226095968185097846443300320e-1+2.1865184886043064750431070089309536965014e-1i",
                "1.2227311715839165658702242958694178339446e-1+2.2249093588553887214665448821337934929199e-1i",
                "1.2216912571614304627924793862589624092163e-1+2.2632666304908261385529009242042821184414e-1i",
                "1.2206360270438618575498637719967514771760e-1+2.3015898092554796480452460839968420999747e-1i",
                "1.2195656116751674341451796225716906356646e-1+2.3398784053803248871070748665321008999305e-1i",
                "1.2184801427198661410956013618460029567444e-1+2.3781319336219643507117599583650953089078e-1i",
                "1.2173797530212034815579811743896132906806e-1+2.4163499133005929018078571338656345914212e-1i",
                "1.2162645765593004597330978976616004631276e-1+2.4545318683364187414489391284647018719623e-1i",
                "1.2151347484093103613508796611491105828944e-1+2.4926773272845428422641125252332597597074e-1i",
            ];

            Complex[] expecteds_i0p125 = [
                "1.2467674692144274392571953770500942151354e-1i",
                "3.8760947137539364194785060530237104238057e-3+1.2467767868298417907044388288917983785034e-1i",
                "7.7522449758918686940405377456755305027736e-3+1.2468047409037335948198225954597354204759e-1i",
                "1.1628506341483045447471225825791559171485e-2+1.2468513351194888847455537875467268365429e-1i",
                "1.5504934378969266942226571088519243372667e-2+1.2469165756175506303172220817825304352863e-1i",
                "1.9381584676856277223034575436134903519151e-2+1.2470004709976191668095995820775260236665e-1i",
                "2.3258512850411298849378615853801745740068e-2+1.2471030323217349100800116017634911893152e-1i",
                "2.7135774548368762748175459004442816759163e-2+1.2472242731182454758183980237596718139848e-1i",
                "3.1013425459646290009277700088375272307079e-2+1.2473642093866599296921040583447751423824e-1i",
                "3.4891521320072987815776165603965261919274e-2+1.2475228596033935072756253431470068250162e-1i",
                "3.8770117919132128151918697142752942106756e-2+1.2477002447284067584627230506734560712682e-1i",
                "4.2649271106720285467958528668298801447649e-2+1.2478963882127436912582315059394399431716e-1i",
                "4.6529036799925018108253350120878197011986e-2+1.2481113160069741151343059860489886324990e-1i",
                "5.0409470989823188032004989831536086104824e-2+1.2483450565705460152138270633539437146631e-1i",
                "5.4290629748302024181404352964121483065417e-2+1.2485976408820544261245884707248833304488e-1i",
                "5.8172569234905046786567049615980210766862e-2+1.2488691024504339191746903943880032938411e-1i",
                "6.2055345703704982948147806918618400204582e-2+1.2491594773270824692669195696613736154046e-1i",
                "6.5939015510205818015237732852674248598626e-2+1.2494688041189251294454593081589730382568e-1i",
                "6.9823635118276142587104907928011085357143e-2+1.2497971240024266119138800506134526681670e-1i",
                "7.3709261107115971422258247672224026885665e-2+1.2501444807385625555563428602548753773344e-1i",
                "7.7595950178259228147614839096540743273018e-2+1.2505109206887599522284320825329720713589e-1i",
                "8.1483759162614108435344200454390561113720e-2+1.2508964928318179081722968612892084865976e-1i",
                "8.5372745027543554267054821508056344353292e-2+1.2513012487818206336846434172475146496097e-1i",
                "8.9262964883988093046876716696539186018480e-2+1.2517252428070552844783764957288784642810e-1i",
                "9.3154475993633317669866702241880920203138e-2+1.2521685318499480229045930930086880836432e-1i",
                "9.7047335776124307213896840705754418075374e-2+1.2526311755480324272404291491952432436906e-1i",
                "1.0094160181632931271634223450943975824488e-1+1.2531132362559651535247722166227085895795e-1i",
                "1.0483733187165505853670485108482545828112e-1+1.2536147790686045478901235117363199024692e-1i",
                "1.0873458387941603710871521813317653176940e-1+1.2541358718451687189758921087249004969506e-1i",
                "1.1263341596426020346703541199535239079681e-1+1.2546765852344904108278027396398420130940e-1i",
                "1.1653388644565350581170218964378655079956e-1+1.2552369927013868677341089034871719139235e-1i",
                "1.2043605384542571956581408462166575555177e-1+1.2558171705541637548005957117859058058327e-1i",
                "1.2433997689538008490724618342855496186087e-1+1.2564171979732730928380583760481077072197e-1i",
                "1.2824571454496928163257620055112408413544e-1+1.2570371570411460844817150753666481246112e-1i",
                "1.3215332596904031046075861639047438163600e-1+1.2576771327732226515762268210061206687243e-1i",
                "1.3606287057565088652583817975720093697191e-1+1.2583372131502004729799946156114553004887e-1i",
                "1.3997440801395998886319790823314233899110e-1+1.2590174891515273083508684846102983080125e-1i",
                "1.4388799818219524918412025019388318858806e-1+1.2597180547901614185028307332240961141718e-1i",
                "1.4780370123569990418099663446572226763900e-1+1.2604390071486259479505055927442529125236e-1i",
                "1.5172157759506207803308435846795186290985e-1+1.2611804464163842217195072163751705118817e-1i",
                "1.5564168795432920571353063934604232616293e-1+1.2619424759285640278856202432606979897195e-1i",
                "1.5956409328931045315619948112679149602873e-1+1.2627252022060601111634788124818755860669e-1i",
                "1.6348885486597003734984199096288788861917e-1+1.2635287349970452928066650763836838109810e-1i",
                "1.6741603424891439801196034419193666488399e-1+1.2643531873199218597821719699615538712652e-1i",
                "1.7134569330997622268032719403575541630192e-1+1.2651986755077461333878668955232546861451e-1i",
                "1.7527789423689837887187170212033887639723e-1+1.2660653192541604360091602522889405171591e-1i",
                "1.7921269954212086042215601767812596037357e-1+1.2669532416608680264538120165646850207457e-1i",
                "1.8315017207167391025980325734986907571064e-1+1.2678625692866879712350283545981184048829e-1i",
                "1.8709037501418053871503719903460322344616e-1+1.2687934321982283633502387091161363293205e-1i",
                "1.9103337190997171503610231499223858734982e-1+1.2697459640222177936723087011081362159638e-1i",
                "1.9497922666031757011793462873011160766734e-1+1.2707203019995365252707171150333708205530e-1i",
                "1.9892800353677801056018963002476059262484e-1+1.2717165870409904201496982142451559552874e-1i",
                "2.0287976719067620809261091359285120624653e-1+1.2727349637848723234689128875170656566311e-1i",
                "2.0683458266269849416051956139040576643096e-1+1.2737755806563573248487025517843904124599e-1i",
                "2.1079251539262425707735856001785690721927e-1+1.2748385899287800925193205238689688554453e-1i",
                "2.1475363122918950864972110534253965118202e-1+1.2759241477868443166346633461684370858112e-1i",
                "2.1871799644008785858752225368203291215355e-1+1.2770324143918162059451363049830593722115e-1i",
                "2.2268567772211270835160653699648935391370e-1+1.2781635539487559602534196015887225865529e-1i",
                "2.2665674221144455138590072233613156676398e-1+1.2793177347758431928428620214849091718952e-1i",
                "2.3063125749408734395294470268808435856454e-1+1.2804951293758544056999013345794144136096e-1i",
                "2.3460929161645799006074374078465652137842e-1+1.2816959145098528293329550130377660903545e-1i",
                "2.3859091309613306525441113484519662055203e-1+1.2829202712731532319671954567825745359182e-1i",
                "2.4257619093275698736536643648969379281748e-1+1.2841683851736266836855303193623960315726e-1i",
                "2.4656519461911592767935513468799850308516e-1+1.2854404462124127336894452890488801814332e-1i",
                "2.5055799415238184341550739293263179766807e-1+1.2867366489671090274576395178848276812746e-1i",
            ];

            Complex[] expecteds_ri = [
                "4.5227844715119068206365839783097936071555e-1+5.3063753095251782601650945810678674290339e-1i",
                "2.4452216513554014646014218660732700395618e-1+2.5489557334055081773117799705577067495819e-1i",
                "1.2433997689538008490724618342855496186087e-1+1.2564171979732730928380583760481077072197e-1i",
                "6.2418335026865473593804976676748139017722e-2+6.2581092782691884841917285297592623360142e-2i",
                "3.1239818543669638396085890619000274002171e-2+3.1260163574964561144024048305669626274193e-2i",
                "1.5623728154929251140991334113397484642356e-2+1.5626271286277258058889015498504630903315e-2i",
                "7.8123410455500842871696852463529293870639e-3+7.8126589369876175441986362357632554244944e-3i",
                "3.9062301315122314157155124189578716724467e-3+3.9062698679420717634266067017523471051488e-3i",
                "1.9531225164646078846165443410132835608315e-3+1.9531274835183390897256153562124538104496e-3i",
                "9.7656218955887534161709691365037769001112e-4+9.7656281044059175133108379656507571851921e-4i",
                "4.8828121119488439768474053422995092531278e-4+4.8828128880509894896989008995583892480841e-4i",
                "2.4414062014936133033587979845318422319798e-4+2.4414062985063814924707740850768334424928e-4i",
                "1.2207031189367019068653169199754486936579e-4+1.2207031310632979305043572071989447187208e-4i",
                "6.1035156174208774598146097124400799101110e-5+6.1035156325791224893634134523019008886314e-5i",
                "3.0517578115526096848591063650013528605695e-5+3.0517578134473903135527068588968340059095e-5i",
                "1.5258789061315762106818345506517667797230e-5+1.5258789063684237892685346125950515597891e-5i",
                "7.6293945311019702633755576430347018453154e-6+7.6293945313980297366089327204799288857808e-6i",
                "3.8146972656064962829226717195895264422326e-6+3.8146972656435037170768436042703057681141e-6i",
                "1.9073486328101870353653566841427606784432e-6+1.9073486328148129646346281697278590781301e-6i",
                "9.5367431640596087942067029549265977987246e-7+9.5367431640653912057932923119079708752045e-7i",
                "4.7683715820308885992758380912329543179499e-7+4.7683715820316114007241617608556259531104e-7i",
                "2.3841857910155798249094797683374670895354e-7+2.3841857910156701750905202270403010439352e-7i",
                "1.1920928955078068531136849712588505049355e-7+1.1920928955078181468863150285967047492355e-7i",
                "5.9604644775390554413921062141412716057767e-8+5.9604644775390695586078937858135894111517e-8i",
            ];

            for ((ddouble x, int index) = (0, 0); index < expecteds_r0p125.Length; x += 1d / 256, index++) {
                Complex z = (0.125, x);

                Complex expected = expecteds_r0p125[index];

                Complex actual = Complex.Asin(z);
                ddouble err = (expected - actual).Magnitude / expected.Magnitude;

                Console.WriteLine($"{z}, err={err:e4}");
                Console.WriteLine(expected);
                Console.WriteLine(actual);

                Assert.IsTrue(err < 2e-31, $"\n{expected}\n{actual}");
            }

            for ((ddouble x, int index) = (0, 0); index < expecteds_i0p125.Length; x += 1d / 256, index++) {
                Complex z = (x, 0.125);

                Complex expected = expecteds_i0p125[index];

                Complex actual = Complex.Asin(z);
                ddouble err = (expected - actual).Magnitude / expected.Magnitude;

                Console.WriteLine($"{z}, err={err:e4}");
                Console.WriteLine(expected);
                Console.WriteLine(actual);

                Assert.IsTrue(err < 2e-31, $"\n{expected}\n{actual}");
            }

            for ((ddouble x, int index) = (0.5, 0); index < expecteds_ri.Length; x /= 2, index++) {
                Complex z = (x, x);

                Complex expected = expecteds_ri[index];

                Complex actual = Complex.Asin(z);
                ddouble err = (expected - actual).Magnitude / expected.Magnitude;

                Console.WriteLine($"{z}, err={err:e4}");
                Console.WriteLine(expected);
                Console.WriteLine(actual);

                Assert.IsTrue(err < 2e-31, $"\n{expected}\n{actual}");
            }
        }
    }
}